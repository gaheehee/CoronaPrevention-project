### CoronaPrevention-project

### 프로젝트 주제 호텔의 “코로나 방역수칙 지키미”  

요즘 가장 중요하고 모두들 겪고 있는 사회적 문제는 코로나라고 생각한다. 1 년이 넘도록
이어지고 있는 코로나 사태에 대하여 많은 사람들이 안일한 생각을 가지고 방역수칙을
지키지 않는 경우가 종종 있다. 구체적으로 5 인 이상 모이는 것은 방역수칙에 어긋난다. 
하지만 몇몇 사람들은 지키지 않고 있다. 이러한 경우를 방지하고 방역수칙을 자동으로
지켜질 수 있도록 하기 위한 “코로나 방역수칙 지키미”를 주제로 하여 프로젝트를
진행하였다.

### 프로젝트 목표  

“코로나 방역수칙 지키미”를 위한 다양한 I/O 용 센서 디바이스 제어에 대하여 Raspberry pi 
환경에서 초음파센서(GPIO), 온도센서(GPIO), 압력센서(spi)– actuator 인 led, 1602 LCD, 모터
PWM 을 소켓프로그래밍을 통해 관리하는 프로그램을 개발하고, 이를 통하여 코로나에 대한
방역수칙 지키미를 개발하는 것이 목표이다.
그리고 “코로나 방역수칙 지키미”를 통하여 호텔에서 호텔을 출입할 때에 입구에서 자동으로
체온을 재고 손소독제를 뿌린다. 일정 체온에 속하고, 손소독제를 뿌린 것을 센서를 통해
확인이 되면 자동으로 문이 열리도록 한다. 그리고 각 호텔 방에 초음파 센서를 부착하여
제한된 인원이 들어갔는지 감지할 수 있도록 하여 방역수칙을 보다 지키기 쉽게 하는 것이
목표이다.  

### 센서파이 1 알고리즘  

두 개의 자식 스레드를 생성하여 각각의 스레드가 통제파이에게 client 로서 소켓 connect 를
요청한다.  
» 첫번째 스레드: SPI 인터페이스를 이용하여 압력을 측정한 후, 연결된 소켓을 통하여
통제파이에게 일정한 간격으로 전송한다.   
» 두번째 스레드: Wiring Pi 를 이용한 온도를 측정한 후, 연결된 소켓을 통하여 통제파이에게
일정한 간격으로 전송한다.  

### 센서파이 2 알고리즘  

두 개의 자식 스레드를 생성한 후, 각각의 스레드는 센서파이 1 과 마찬가지로 client 로서
통제파이에게 소켓 connect 를 요청한다. 
» 첫번째 스레드: GPIO 인터페이스를 통하여 초음파 센서로 지속적으로 거리를 측정하고, 
측정된 거리를 가장 최신의 20 개의 기록을 유지한다. 거리를 측정하고 기록을 최신화한 후
만약 오래된 기록 10 개의 평균은 문까지의 거리보다 멀고 신규 기록 10 개의 평균은 가까우면 사람이 문 안쪽으로 들어왔다고 판단하고 그 반대의 경우엔 사람이 문 밖으로
나갔다고 판단하여 전역변수로 선언된 인원수를 증가 감소 시키고 인원수를 소켓을 통해
통제파이에게 전송한다. 
이 때 기록이 최신화 되는 과정에서 출입이 중복 판정되거나, 센서의 오측정에 의한
outlier 로 인한 출입 오판정등을 방지하기 위해 특정 상황에는 기록을 초기화 시키는데 그
상황으로는 출입이 판정된 경우와 문에서 일정거리 밖의 거리가 측정되는 경우이다. 출입이
판정된 경우엔 모든 기록을 현재 측정된 거리로 초기화 시켜 다음 측정에서 기록이 최신화
되는 과정에서 출입이 중복판정되는것을 막는다. 문에서 일정거리 밖의 거리가 측정되는
경우는 현재 문이 열려있거나 방 안의 인원이 우연히 센서를 센서 근처에서 가린 경우, 
센서의 오측정으로 인해 값에 outlier 가 발생한 경우 등인데 이러한 경우엔 오판정이 일어날
확률이 높기 때문에 모든 기록을 문까지의 거리로 초기화 시켜 출입 판정이 일어나지 않도록
한다.  

» 두번째 스레드: 소켓을 통해 통제파이에게서 WARNING 신호를 수신받아 신호에 따라서
RGB_LED 를 제어한다.   
» WARNING 신호: 5 인 이상 출입이 감지 됐을 시 1, 5 인 미만일 시에 0 이 수신된다.  
» RGB_LED: WARNING = 0 일 시에 GPIO 인터페이스를 통해 일정한 밝기의 초록불을
출력하고, WARNING = 1 일 시에 PWM 인터페이스를 통해 서서히 깜빡이는 빨간 불을
출력하여 경고의 의미를 나타낸다.  

### 통제파이 알고리즘  

통제파이는 총 5 개의 자식 스레드를 생성한다.   
» 스레드 3 개: 각각 압력, 온도, 인원수를 센서파이에게서 수신하여 전역변수에 저장해주는
스레드이며, server 소켓을 생성하여 통신한다.  
» 스레드 1 개: 수신된 압력과 온도를 통해 정상 체온인지, 손소독제를 사용했는지 판단하여
1602LCD 를 통하여 결과를 공지하고 스텝 모터를 이용하여 문을 통제한다.  
평상시엔 1602LCD 로 체온측정 유도문구를 출력하고 일정한 간격으로 전역변수에 저장된
온도가 정상체온 범위에 들어오는지를 확인한다. 만약 온도가 정상체온 범위에 들어오면 측정된 체온과 함께 정상체온으로 측정되었다는 문구를 1602LCD 에 잠시 출력해준 뒤
손소독제 사용 유도문구를 출력하고 10 초간 전역변수에 저장된 압력이 손소독제를 사용할
정도의 역치 이상의 값이 되는지를 확인한다. 만약 역치 이상의 값을 기록하면 출입허가
문구를 출력하고 스텝모터를 90 도 회전시킨 뒤 5 초 뒤 원 상태로 복귀 후 체온측정 단계로
돌아간다. 10 초간 압력이 역치를 넘지 않으면 바로 체온측정 단계로 돌아간다.  

